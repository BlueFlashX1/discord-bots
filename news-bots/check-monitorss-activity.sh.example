#!/bin/bash

# Check MonitoRSS activity and help test article posting
VPS_HOST="${VPS_HOST:-root@your-vps-ip}"
SSH_KEY="${SSH_KEY:-$HOME/.ssh/your_deploy_key}"
API_URL="http://localhost:8000"

echo "=========================================="
echo "MonitoRSS Activity Check & Test Guide"
echo "=========================================="
echo ""

# Check API health
echo "ðŸ” Checking MonitoRSS API..."
HEALTH=$(ssh -i "$SSH_KEY" -o StrictHostKeyChecking=no "$VPS_HOST" "curl -s $API_URL/api/v1/health 2>/dev/null")
if [ "$HEALTH" = '{"ok":1}' ]; then
    echo "âœ… MonitoRSS API is accessible"
else
    echo "âŒ MonitoRSS API not responding"
    exit 1
fi

echo ""
echo "=========================================="
echo "How to Test Article Posting:"
echo "=========================================="
echo ""
echo "Method 1: Check Your Discord Channels (Easiest)"
echo "  â†’ MonitoRSS may already be posting articles automatically"
echo "  â†’ Check your Discord server channels for recent RSS feed posts"
echo "  â†’ If you see posts, MonitoRSS is working!"
echo ""
echo "Method 2: Build Frontend on macOS & Sync to VPS"
echo "  â†’ Build on your Mac (more memory available):"
echo "    cd ~/path/to/discord/bots/news-bots/MonitoRSS/services/backend-api/client"
echo "    npm install"
echo "    npm run build"
echo "  â†’ Then sync the build directory to VPS"
echo ""
echo "Method 3: Use API Directly (Requires Feed ID & Auth)"
echo "  â†’ Need: Discord OAuth token, Feed ID, Channel ID"
echo "  â†’ Endpoint: POST $API_URL/api/v1/user-feeds/{feedId}/test-send"
echo ""
echo "=========================================="
echo "Current Service Status:"
echo "=========================================="
ssh -i "$SSH_KEY" -o StrictHostKeyChecking=no "$VPS_HOST" "pm2 list | grep monitorss" 2>/dev/null
echo ""
