# VPS Deployment Rule - MANDATORY

## ⚠️ CRITICAL: Always Update Both Local AND VPS

**When fixing or updating ANY Discord bot, you MUST update BOTH:**

1. ✅ **Local/macOS version** (development machine at `~/Documents/DEVELOPMENT/discord/bots/`)
2. ✅ **VPS version** (production server at `64.23.179.177`)

**AI assistants frequently forget to update the VPS. This rule exists to prevent that.**

---

## VPS Information

- **Host**: `64.23.179.177`
- **User**: `root`
- **SSH Key**: `~/.ssh/id_rsa_deploy` or `~/.ssh/vps_key`
- **Bot Directory**: `/root/discord-bots/[bot-name]/`
- **Process Manager**: PM2
- **Logs**: `/root/discord-bots/logs/[bot-name]-*.log`

---

## Workflow (MANDATORY)

### Step 1: Fix Code Locally
```bash
# Make your fixes
cd ~/Documents/DEVELOPMENT/discord/bots/[bot-name]
# Edit files, test, etc.
```

### Step 2: Update VPS (REQUIRED - DO NOT SKIP)

**For grammar-bot:**
```bash
cd ~/Documents/DEVELOPMENT/discord/bots
./scripts/update-grammar-bot-vps.sh
```

**For other bots (manual):**
```bash
# Copy files
scp -i ~/.ssh/id_rsa_deploy \
  [bot-name]/[file1] \
  root@64.23.179.177:/root/discord-bots/[bot-name]/

# Restart bot
ssh -i ~/.ssh/id_rsa_deploy root@64.23.179.177 \
  "pm2 restart [bot-name]"
```

### Step 3: Verify VPS Update
```bash
# Check bot status
ssh -i ~/.ssh/id_rsa_deploy root@64.23.179.177 \
  "pm2 list | grep [bot-name]"

# Check logs
ssh -i ~/.ssh/id_rsa_deploy root@64.23.179.177 \
  "pm2 logs [bot-name] --lines 20"
```

---

## Why This Matters

- **Users interact with the VPS bot**, not the local one
- **Both bots can run simultaneously** - they need to stay in sync
- **Fixes only work if deployed to VPS** - local fixes don't help users

---

## Common Mistakes

❌ **Fix locally, test locally, assume done**
- **Problem**: VPS bot still has old code
- **Result**: Users still see the bug

❌ **Update VPS but forget to restart PM2**
- **Problem**: Old code still running in memory
- **Result**: Fix doesn't take effect

❌ **Forget to verify VPS update**
- **Problem**: Update might have failed silently
- **Result**: Bot appears "fixed" but actually broken

---

## Quick Reference

### Grammar Bot Update Script
```bash
./scripts/update-grammar-bot-vps.sh
```

### PM2 Commands (on VPS)
```bash
pm2 restart [bot-name]    # Restart specific bot
pm2 list                  # List all bots
pm2 logs [bot-name]       # View logs
```

### Check VPS Status
```bash
ssh -i ~/.ssh/id_rsa_deploy root@64.23.179.177 "pm2 list"
```

---

## Full Documentation

See: `docs/VPS-DEPLOYMENT-REQUIREMENT.md` for complete guide.

---

## AI Assistant Checklist

When fixing any Discord bot:

- [ ] Fix code locally
- [ ] Test locally (optional)
- [ ] **UPDATE VPS** ← **MANDATORY - DO NOT SKIP**
- [ ] **VERIFY VPS update** (check logs, test on VPS)
- [ ] Document what was fixed

**Remember: Users interact with the VPS bot, not the local one!**

---

**This rule exists because AI assistants keep forgetting the VPS update step.**
